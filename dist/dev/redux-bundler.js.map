{"version":3,"file":"redux-bundler.js","names":["h","render","loadSubApp","Provider","setStoreContainer","getReduxCreateStore","window","global","reduxRenderStart","_ref","store","Component","element","component","reduxBundlerLoadSubApp","info","renderStart","instance","StartComponent","_reduxRenderStart","_store","preRender","initialState","_prepared","reduxCreateStore","signalReady","_this","realize","Promise","resolve","then","reduxStoreReady","reduxBundles","bundles","extras","__preRender","__signalReady","__redux","_genReduxCreateStore","Object","assign"],"sources":["../../src/redux-bundler.jsx"],"sourcesContent":["/** @jsx h */\n\nimport { h, render } from \"preact\";\nimport { loadSubApp } from \"subapp-web\";\nimport { Provider } from \"redux-bundler-preact\";\nimport { setStoreContainer, getReduxCreateStore } from \"./shared\";\n\nsetStoreContainer(typeof window === \"undefined\" ? global : window);\n\n//\n// client side function to start a subapp with redux-bundler support\n//\nexport function reduxRenderStart({ store, Component, element }) {\n  let component;\n\n  if (element) {\n    render(\n      <Provider store={store}>\n        <Component />\n      </Provider>,\n      element\n    );\n  } else {\n    component = (\n      <Provider store={store}>\n        <Component />\n      </Provider>\n    );\n  }\n\n  return { store, component };\n}\n\n//\n// Load a subapp with redux-bundler support\n// info - the subapp's information\n//\nexport function reduxBundlerLoadSubApp(info) {\n  const renderStart = function(instance, element) {\n    const Component = this.info.StartComponent || this.info.Component;\n\n    const { component } = reduxRenderStart({\n      store: instance._store,\n      Component,\n      // serverSideRendering: instance.serverSideRendering,\n      element\n    });\n\n    return component;\n  };\n\n  const preRender = function(instance) {\n    const initialState = instance._prepared || instance.initialState;\n    const reduxCreateStore = instance.reduxCreateStore || this.info.reduxCreateStore;\n    instance._store = instance._store || reduxCreateStore(initialState);\n\n    return instance;\n  };\n\n  const signalReady = function(instance) {\n    const store = instance._store;\n\n    if (store.realize) {\n      instance._store = store.realize();\n    }\n\n    return Promise.resolve()\n      .then(() => {\n        if (this.info.reduxStoreReady) {\n          return this.info.reduxStoreReady({ store: instance._store });\n        }\n      })\n      .then(() => instance);\n  };\n\n  // allow subApp to specify redux bundles as reduxBundles or bundles\n  const reduxBundles = info.reduxBundles || info.bundles;\n\n  const extras = {\n    reduxBundles,\n    __preRender: preRender,\n    __signalReady: signalReady,\n    __redux: true\n  };\n\n  if (!info.reduxCreateStore) {\n    extras._genReduxCreateStore = \"subapp\";\n    extras.reduxCreateStore = getReduxCreateStore(info);\n  }\n\n  return loadSubApp(Object.assign(extras, info), renderStart);\n}\n"],"mappings":"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"}