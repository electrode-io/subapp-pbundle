{"version":3,"file":"redux-bundler.js","names":["_preact","require","_subappWeb","_reduxBundlerPreact","_shared","setStoreContainer","window","global","reduxRenderStart","store","Component","element","component","render","h","Provider","reduxBundlerLoadSubApp","info","renderStart","instance","StartComponent","_store","preRender","initialState","_prepared","reduxCreateStore","signalReady","realize","Promise","resolve","then","reduxStoreReady","reduxBundles","bundles","extras","__preRender","__signalReady","__redux","_genReduxCreateStore","getReduxCreateStore","loadSubApp","Object","assign"],"sources":["../../src/redux-bundler.jsx"],"sourcesContent":["/** @jsx h */\n\nimport { h, render } from \"preact\";\nimport { loadSubApp } from \"subapp-web\";\nimport { Provider } from \"redux-bundler-preact\";\nimport { setStoreContainer, getReduxCreateStore } from \"./shared\";\n\nsetStoreContainer(typeof window === \"undefined\" ? global : window);\n\n//\n// client side function to start a subapp with redux-bundler support\n//\nexport function reduxRenderStart({ store, Component, element }) {\n  let component;\n\n  if (element) {\n    render(\n      <Provider store={store}>\n        <Component />\n      </Provider>,\n      element\n    );\n  } else {\n    component = (\n      <Provider store={store}>\n        <Component />\n      </Provider>\n    );\n  }\n\n  return { store, component };\n}\n\n//\n// Load a subapp with redux-bundler support\n// info - the subapp's information\n//\nexport function reduxBundlerLoadSubApp(info) {\n  const renderStart = function(instance, element) {\n    const Component = this.info.StartComponent || this.info.Component;\n\n    const { component } = reduxRenderStart({\n      store: instance._store,\n      Component,\n      // serverSideRendering: instance.serverSideRendering,\n      element\n    });\n\n    return component;\n  };\n\n  const preRender = function(instance) {\n    const initialState = instance._prepared || instance.initialState;\n    const reduxCreateStore = instance.reduxCreateStore || this.info.reduxCreateStore;\n    instance._store = instance._store || reduxCreateStore(initialState);\n\n    return instance;\n  };\n\n  const signalReady = function(instance) {\n    const store = instance._store;\n\n    if (store.realize) {\n      instance._store = store.realize();\n    }\n\n    return Promise.resolve()\n      .then(() => {\n        if (this.info.reduxStoreReady) {\n          return this.info.reduxStoreReady({ store: instance._store });\n        }\n      })\n      .then(() => instance);\n  };\n\n  // allow subApp to specify redux bundles as reduxBundles or bundles\n  const reduxBundles = info.reduxBundles || info.bundles;\n\n  const extras = {\n    reduxBundles,\n    __preRender: preRender,\n    __signalReady: signalReady,\n    __redux: true\n  };\n\n  if (!info.reduxCreateStore) {\n    extras._genReduxCreateStore = \"subapp\";\n    extras.reduxCreateStore = getReduxCreateStore(info);\n  }\n\n  return loadSubApp(Object.assign(extras, info), renderStart);\n}\n"],"mappings":"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"}