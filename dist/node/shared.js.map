{"version":3,"file":"shared.js","names":["_reduxBundler","require","shared","setStoreContainer","container","setSharedStore","store","getSharedStore","clearSharedStore","createDeferStore","bundles","initialState","storeContainer","realize","real","composeBundlesRaw","apply","undefined","getReduxCreateStore","info","reduxBundles","reduxCreateStore","forEach","b","indexOf","push","Object","assign","integratedBundles","values","meta","chunks","rawBundles","unintegratedBundles","filter","bundle","integrateBundles"],"sources":["../../src/shared.js"],"sourcesContent":["import { composeBundlesRaw } from \"redux-bundler\";\n//\n// - stores can be shared between subapps with reduxShareStore flag\n//  - if it's true, then a common global store is used\n//  - if it's a string, then it's use to name a store for sharing.\n//  - otherwise subapp gets its own private store\n// - state sharing is made possible through redux-bundler\n//\n\nlet shared = {};\n\nfunction setStoreContainer(container) {\n  shared = container;\n}\n\nfunction setSharedStore(store, container) {\n  (container || shared).store = store;\n}\n\nfunction getSharedStore(container) {\n  return (container || shared).store;\n}\n\nfunction clearSharedStore(container) {\n  setSharedStore(null, container);\n}\n\n//\n// create a proxy store to aggregate bundles and initial states\n// from subapps, until realize is called, which would create the\n// actual redux store with all combined bundles and initial state\n//\nfunction createDeferStore(bundles, initialState, storeContainer) {\n  const store = { bundles, initialState };\n  store.realize = () => {\n    let real = store.real;\n    if (!real) {\n      // Using apply to destruct bundles array as arguments\n      // not doing ... because babel would intro some toConsumableArray call\n      store.real = real = composeBundlesRaw.apply(undefined, store.bundles)(store.initialState);\n      setSharedStore(real, storeContainer);\n    }\n    return real;\n  };\n\n  return store;\n}\n\nfunction getReduxCreateStore(info) {\n  const bundles = info.reduxBundles || [];\n  return function reduxCreateStore(initialState, storeContainer) {\n    let store = getSharedStore(storeContainer);\n    if (!store) {\n      store = createDeferStore(bundles, initialState || {}, storeContainer);\n      setSharedStore(store, storeContainer);\n    } else if (store.realize) {\n      bundles.forEach(b => {\n        if (store.bundles.indexOf(b) < 0) {\n          store.bundles.push(b);\n        }\n      });\n      Object.assign(store.initialState, initialState);\n    } else {\n      const integratedBundles = Object.values(store.meta.chunks[0].rawBundles);\n      const unintegratedBundles = bundles.filter(bundle => integratedBundles.indexOf(bundle) < 0);\n      // using apply to destruct bundles array into arguments\n      store.integrateBundles(...unintegratedBundles);\n    }\n    return store;\n  };\n}\n\nexport { setStoreContainer, getReduxCreateStore, getSharedStore, setSharedStore, clearSharedStore };\n"],"mappings":";;;;;;;;;;AAAA,IAAAA,aAAA,GAAAC,OAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAIC,MAAM,GAAG,CAAC,CAAC;AAEf,SAASC,iBAAiBA,CAACC,SAAS,EAAE;EACpCF,MAAM,GAAGE,SAAS;AACpB;AAEA,SAASC,cAAcA,CAACC,KAAK,EAAEF,SAAS,EAAE;EACxC,CAACA,SAAS,IAAIF,MAAM,EAAEI,KAAK,GAAGA,KAAK;AACrC;AAEA,SAASC,cAAcA,CAACH,SAAS,EAAE;EACjC,OAAO,CAACA,SAAS,IAAIF,MAAM,EAAEI,KAAK;AACpC;AAEA,SAASE,gBAAgBA,CAACJ,SAAS,EAAE;EACnCC,cAAc,CAAC,IAAI,EAAED,SAAS,CAAC;AACjC;;AAEA;AACA;AACA;AACA;AACA;AACA,SAASK,gBAAgBA,CAACC,OAAO,EAAEC,YAAY,EAAEC,cAAc,EAAE;EAC/D,MAAMN,KAAK,GAAG;IAAEI,OAAO;IAAEC;EAAa,CAAC;EACvCL,KAAK,CAACO,OAAO,GAAG,MAAM;IACpB,IAAIC,IAAI,GAAGR,KAAK,CAACQ,IAAI;IACrB,IAAI,CAACA,IAAI,EAAE;MACT;MACA;MACAR,KAAK,CAACQ,IAAI,GAAGA,IAAI,GAAGC,+BAAiB,CAACC,KAAK,CAACC,SAAS,EAAEX,KAAK,CAACI,OAAO,CAAC,CAACJ,KAAK,CAACK,YAAY,CAAC;MACzFN,cAAc,CAACS,IAAI,EAAEF,cAAc,CAAC;IACtC;IACA,OAAOE,IAAI;EACb,CAAC;EAED,OAAOR,KAAK;AACd;AAEA,SAASY,mBAAmBA,CAACC,IAAI,EAAE;EACjC,MAAMT,OAAO,GAAGS,IAAI,CAACC,YAAY,IAAI,EAAE;EACvC,OAAO,SAASC,gBAAgBA,CAACV,YAAY,EAAEC,cAAc,EAAE;IAC7D,IAAIN,KAAK,GAAGC,cAAc,CAACK,cAAc,CAAC;IAC1C,IAAI,CAACN,KAAK,EAAE;MACVA,KAAK,GAAGG,gBAAgB,CAACC,OAAO,EAAEC,YAAY,IAAI,CAAC,CAAC,EAAEC,cAAc,CAAC;MACrEP,cAAc,CAACC,KAAK,EAAEM,cAAc,CAAC;IACvC,CAAC,MAAM,IAAIN,KAAK,CAACO,OAAO,EAAE;MACxBH,OAAO,CAACY,OAAO,CAACC,CAAC,IAAI;QACnB,IAAIjB,KAAK,CAACI,OAAO,CAACc,OAAO,CAACD,CAAC,CAAC,GAAG,CAAC,EAAE;UAChCjB,KAAK,CAACI,OAAO,CAACe,IAAI,CAACF,CAAC,CAAC;QACvB;MACF,CAAC,CAAC;MACFG,MAAM,CAACC,MAAM,CAACrB,KAAK,CAACK,YAAY,EAAEA,YAAY,CAAC;IACjD,CAAC,MAAM;MACL,MAAMiB,iBAAiB,GAAGF,MAAM,CAACG,MAAM,CAACvB,KAAK,CAACwB,IAAI,CAACC,MAAM,CAAC,CAAC,CAAC,CAACC,UAAU,CAAC;MACxE,MAAMC,mBAAmB,GAAGvB,OAAO,CAACwB,MAAM,CAACC,MAAM,IAAIP,iBAAiB,CAACJ,OAAO,CAACW,MAAM,CAAC,GAAG,CAAC,CAAC;MAC3F;MACA7B,KAAK,CAAC8B,gBAAgB,CAAC,GAAGH,mBAAmB,CAAC;IAChD;IACA,OAAO3B,KAAK;EACd,CAAC;AACH"}